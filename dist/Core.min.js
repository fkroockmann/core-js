/*! backbee-core-js 0.1.1 */
/*
 * Copyright (c) 2011-2013 Lp digital system
 *
 * This file is part of BackBee.
 *
 * BackBee is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * BackBee is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with BackBee. If not, see <http://www.gnu.org/licenses/>.
 */
!function(){"use strict";define("Core",["Core/Api","Core/ApplicationManager","Core/Mediator","Core/RouteManager","Core/ControllerManager","Core/Utils","Core/Exception","Core/Scope","Core/Config"],function(a){return Object.freeze(a)})}(),define("Core/Api",[],function(){"use strict";var a={},b={register:function(a,b){this.hasOwnProperty(a)||(this[a]=b)},set:function(b,c){this.Mediator.publish("api:set:"+b,c),a[b]=c},get:function(b){return a[b]},unset:function(b){a[b]=null,delete a[b]}};return b}),define("Core/ApplicationContainer",["jquery","jsclass","Core/Api"],function(a,b){"use strict";var c,d=null;return c=new JS.Class({initialize:function(){this.container=[]},register:function(c){a.isPlainObject(c)||b.exception("AppContainerException",6e4,"applicationInfos should be an object"),c.hasOwnProperty("name")||b.exception("AppContainerException",60001,"applicationInfos should have a name property"),this.container.push(c)},getByAppInfosName:function(b){var c=null;return a.each(this.container,function(a,d){return d.name===b?(c=d,!1):void(a+=1)}),c},reset:function(){this.container=[]}}),{getInstance:function(){return d||(d=new c),d}}}),define("Core/ApplicationManager",["require","BackBone","jsclass","jquery","underscore","Core/Utils","Core/ApplicationContainer","Core/Api","Core/ControllerManager"],function(a){"use strict";var b=a("jquery"),c=a("underscore"),d=a("Core/Api"),e=a("BackBone"),f=a("Core/Utils"),g=a("Core/ControllerManager"),h={},i=null,j=null,k={},l=a("Core/ApplicationContainer").getInstance(),m=new JS.Class({initialize:function(a){this.config={},this.state=0,c.extend(this,e.Events),this.config=b.extend(!0,this.config,a),this.onInit()},getMainRoute:function(){return this.config.mainRoute},exposeMenu:function(){},dispatchToController:function(a,d,e){var f=new b.Deferred;return g.loadController(this.getName(),a).done(function(a){try{e=c.rest(e),a.invoke(d,e)}catch(b){f.reject(b)}}).fail(function(a){f.reject(a.message)}),f.promise()},invokeControllerService:function(a,c,e){var f,h=new b.Deferred,i=this;return g.loadControllerByShortName(this.getName(),a).done(function(a){try{f=c+"Service",a.beforeCall(f).then(function(b){b&&e.unshift(b);try{h.resolve(a[f].apply(a,e))}catch(c){d.exception.silent("InvokeServiceException",15008,"Something goes worng during the service "+f+" execution",{controller:i.getName(),service:f,error:c})}},function(){h.resolve(a[f].apply(a,e))})}catch(b){h.reject(b)}}).fail(function(a){h.reject(a)}),h.promise()},setControllerMng:function(a){return a},onInit:function(){},onStart:function(){this.trigger(this.getName()+":onStart")},onStop:function(){},onResume:function(){},onError:function(a){d.exception.silent("AbstractApplicationException",1,"error in["+this.name+"] application",{error:a})}}),n=function(a,b){if("string"!=typeof a)throw"ApplicationManager :appname should be a string";if("object"!=typeof b)throw"ApplicationManager : appDef Is undefined";var c=new JS.Class(m,b);c.define("getName",function(a){return function(){return this.name=a,a}}(a)),h.hasOwnProperty(a)&&d.exception("ApplicationManagerException",50007,"An application named ["+a+"] already exists."),h[a]=c},o=function(a){var c=new b.Deferred;return f.requireWithPromise(a).done(function(){k.trigger("routesLoaded"),c.resolve.apply(this,arguments)}).fail(function(a){c.reject(a)})},p=function(a,c){var e,f=new b.Deferred,g=l.getByAppInfosName(a),j=h[a];try{if(c=c||{},i&&i.getName()===a)f.resolve(i);else{if(g)i.onStop(),g.instance.onResume(),e=g.instance;else{if(!j)return q(a,c);e=new j(c),g={instance:e,name:a},i&&i.onStop(),l.register(g),g.instance.onInit(),g.instance.onStart(),e=g.instance}i=e,f.resolve(i)}}catch(k){d.exception.silent("ApplicationManagerException",500013,"An exception as been caught during "+a+" launching",{error:k})}return f.promise()},q=function(a,c,d){var e=new b.Deferred,g="boolean"==typeof d?d:!0,h=["app."+a];return f.requireWithPromise(h).done(function(){g?p(a,c).done(e.resolve):e.resolve.apply(arguments)}).fail(function(){e.reject("Application["+h+"] can't be found")}),e.promise()},r=function(){var a=j.applications[j.active]||{};return a.hasOwnProperty("config")&&(a=a.config),q(j.active,a).then(function(a){d.Mediator.publish("on:application:ready",a),k.trigger("appIsReady",a)})},s=function(){i=null,j=null,k.off(),l.reset()},t=function(a){k.trigger("appError",{reason:a})},u=function(a){a&&b.isPlainObject(a)||d.exception("ApplicationManagerException",50001,"init expects a parameter one to be an object.");var e=[],g="",h=[],i=[],k=this;j=a,j.hasOwnProperty("appPath")||d.exception("ApplicationManagerException",50002,"InvalidAppConfig [appPath] key is missing"),j.hasOwnProperty("applications")||d.exception("ApplicationManagerException",50003,"InvalidAppConfig [applications] key is missing"),j.hasOwnProperty("active")||d.exception("ApplicationManagerException",50004,"InvalidAppConfig [active] key is missing"),b.isPlainObject(a.applications)||d.exception("ApplicationManagerException",50005,"InvalidAppConfig [applications] should be an object"),0===c.size(j.applications)&&d.exception("ApplicationManagerException",50006,"InvalidAppConfig at least one application config should be provided"),b.each(j.applications,function(a,c){i.push(j.appPath+"/"+a+"/main.js"),g=a+".routes",h.push("app."+a),c.config.hasOwnProperty("routePath")&&"string"==typeof c.config.routePath&&(g=c.config.routePath),e.push(g),c.hasOwnProperty("scope")&&b.each(c.scope,function(b,c){d.Scope.subscribe(b,function(){c.open&&k.invokeService(a+"."+c.open)},function(){c.open&&k.invokeService(a+"."+c.close)})})}),f.requireWithPromise(i).then(b.proxy(o,null,e)).done(r).fail(t)},v=function(a,b){b=b||{},a&&"string"==typeof a||d.exception("ApplicationManagerException",50009,"Application.invoke actionInfos should be a string"),a=a.split(":"),3!==a.length&&d.exception("ApplicationManagerException",50010,"Invalid actionInfos. Valid format {appname}:{controllerName}:{controllerAction}");var c=p(a[0]);c.fail(function(a){k.trigger("appError",{reason:a})}),c.done(function(c){c.dispatchToController(a[1],a[2],b).fail(function(a){k.trigger("appError",{reason:a})})})},w=function(a,b){b=b||{},"string"!=typeof a&&d.exception("ApplicationManagerException",50009,"appName should be a string and config should be an object");var c,e,f=null;if(e=l.getByAppInfosName(a),e&&e.hasOwnProperty("instance"))f=e.instance;else{if(c=h[a],!c)return f;f=new c(b),e={instance:f,name:a},l.register(e)}return f},x=function(a){var c,e,f,g,h,i,j=new b.Deferred;return a&&"string"==typeof a||d.exception("ApplicationManagerException",50011,"invokeService expects parameter one to be a string."),g=b.merge([],arguments),g.shift(),c=a.split("."),3!==c.length&&d.exception("ApplicationManagerException",50012,""),e=c[0],f=c[2],i=c[1],h=w(e),h?h.invokeControllerService(i,f,g).done(j.resolve).fail(j.reject):q(e,{},!1).done(function(){h=w(e),h.invokeControllerService(i,f,g).done(j.resolve).fail(j.reject)}).fail(function(a){k.trigger("appError",{reason:a})}),j.promise()};return k={registerApplication:n,invoke:v,invokeService:x,launchApplication:p,init:u,reset:s},c.extend(k,e.Events),d.register("ApplicationManager",k),k}),define("Core/Config",["require","Core/Api"],function(a){"use strict";var b=a("Core/Api"),c={},d=function(a){var c;for(c in a)if(a.hasOwnProperty(c)&&b.hasOwnProperty(c))try{b[c].init(a[c])}catch(d){b.exception.silent("CoreConfigurationException",12300,"Config injection fail for "+c+" core object with message : "+d)}},e=function(a){var b;for(b in a)a.hasOwnProperty(b)&&"object"==typeof a[b]&&null!==a[b]&&e(a[b]);Object.freeze(a)},f=function(a){a.hasOwnProperty("core")&&(d(a.core),delete a.core),c=a,e(c)},g=function(a,b){var c=a.pop();return b.hasOwnProperty(c)?a.length>0?g(a,b[c]):b[c]:void 0},h=function(a){var b=a.split(":");return g(b.reverse(),c)};b.register("initConfig",f),b.register("config",h)}),define("Core/ControllerManager",["require","Core/Api","Core/ApplicationContainer","jquery","jsclass","Core/Utils"],function(a){"use strict";var b=a("Core/Api"),c=a("jquery"),d=a("Core/Utils"),e=a("Core/ApplicationContainer"),f={},g={},h={},i=null,j=function(a,c){b.exception("ControllerManagerException",a,c)},k=new JS.Class({initialize:function(){this.state=0,this.enabled=!1;var a=e.getInstance().getByAppInfosName(this.appName);this.mainApp=a.instance},handleImport:function(){var a=new c.Deferred;return c.isArray(this.config.imports)&&this.config.imports.length?d.requireWithPromise(this.config.imports).done(a.resolve).fail(function(b){var c={method:"ControllerManager:handleImport",message:b};a.reject(c)}):a.resolve(),a.promise()},beforeCall:function(e){var f=new c.Deferred,g=this;return void 0!==this.config.define&&void 0!==this.config.define[e]?d.requireWithPromise(this.config.define[e]).then(function(){f.resolve.call(g,a)},function(a){b.exception.silent("ControllerManagerException",15007,"Something goes worng during the depencies loading of "+e,{service:e,reason:a,depencies:g.config.define[e]}),f.reject.call(g)}):f.resolve.call(g,!1),f.promise()},onEnabled:function(){this.enabled=!0},onDisabled:function(){this.enabled=!1},invoke:function(a,b){var c=a+"Action";"function"!=typeof this[c]&&j(15001,c+" Action Doesnt Exists in "+this.getName()+" Controller"),"function"!=typeof this[c]&&j(15001,c+" Action Doesnt Exists in "+this.getName()+" Cotroller");try{this[c].apply(this,b)}catch(d){j(15002,"Error while executing ["+c+"] in "+this.getName()+" controller with message: "+d)}}}),l=function(a){a!==i&&(i&&i.onDisabled(),i=a,i.onEnabled())},m=function(a){var b="",c=-1;return"string"==typeof a&&(c=a.indexOf("Controller")),-1!==c&&(a=a.substring(0,c),b=a.toLowerCase()+".controller"),0===b.length&&j(15004,"Controller name do not respect {name}Controller style declaration"),b},n=function(b,c,d){var e,g=b+"."+m(c);e=new f[b][c],h[g]=e,e.handleImport().then(function(){e.onInit(a),l(e),d.resolve(e)})},o=function(a){var b,c=m(a);return c=c.split("."),b=c[0]},p=function(a,b){var c=b.appName,d=o(a),e={};!1===b.hasOwnProperty("appName")&&j(15003,"Controller should be attached to an App"),b.hasOwnProperty("initialize")&&delete b.initialize,e=new JS.Class(k,b),e.define("initialize",function(a){return function(){this.callSuper(a)}}(b.config)),e.define("getName",function(a){return function(){return a}}(a)),f[c]||(f[c]={}),f[c][a]=e,d=d.toLowerCase(),g[c+":"+d]={constructor:e,originalName:a}},q=function(a,b){var e=a+"."+m(b),g=c.Deferred(),i="";return a&&"string"==typeof a||j(15005,"appName have to be defined as String"),i=h[e],i?(l(i),g.resolve(i)):f.hasOwnProperty(a)&&"function"==typeof f[a][b]?n(a,b,g):d.requireWithPromise([e]).done(function(){n(a,b,g)}).fail(g.reject),g.promise()},r=function(a,b){var e,f,h=new c.Deferred,i=a+"."+b+".controller";return a&&"string"==typeof a||j(15005,"appName have to be defined as String"),a&&"string"==typeof a||j(15006,"shortControllerName have to be defined as String"),(f=g[a+":"+b])?q(a,f.originalName):(d.requireWithPromise([i]).done(function(){return e=g[a+":"+b].originalName,q(a,e).done(h.resolve).fail(h.reject)}).fail(h.reject),h.promise())},s=function(a){return f.hasOwnProperty(a)?f[a]:void j(15006,"Controller Not Found")},t={registerController:p,loadController:q,loadControllerByShortName:r,getAppControllers:s,getAllControllers:function(){return f}};return b.register("ControllerManager",t),t}),define("Core/DriverHandler",["underscore","jquery","jsclass"],function(a,b){"use strict";var c=new JS.Class({AVAILABLE_ACTIONS:["create","read","update","delete","patch","link"],drivers:{},defaultDriverId:null,mappings:{},hasDriver:function(b){return a.contains(a.keys(this.drivers),b)},addDriver:function(a,b,c){return!1===this.hasDriver(a)&&(this.drivers[a]=b),(!0===c||null===this.defaultDriverId)&&this.defaultDriver(a),this},getDriver:function(a){var b=null;return this.hasDriver(a)&&(b=this.drivers[a]),b},defaultDriver:function(a){return!0===this.hasDriver(a)&&(this.defaultDriverId=a),this},addActionDriverMapping:function(a,b){var c;if(!0===Array.isArray(b))for(c in b)b.hasOwnProperty(c)&&(c=b[c],!0===this.isValidActionDriverMapping(c)&&(!1===this.mappings.hasOwnProperty(a)&&(this.mappings[a]={}),this.mappings[a][c.action]=c));return this},isValidActionDriverMapping:function(b){var c;if(!1===b.hasOwnProperty("action")||!1===b.hasOwnProperty("drivers"))return!1;if(!1===a.contains(this.AVAILABLE_ACTIONS,b.action))return!1;if(!1===Array.isArray(b.drivers)||0===b.drivers.length)return!1;for(c in b.drivers)if(b.drivers.hasOwnProperty(c)&&(c=b.drivers[c],!1===this.hasDriver(c)))return!1;return!0},create:function(a,b){return this.doGenericAction("create",a,{data:b})},read:function(a,b,c,d,e){return this.doGenericAction("read",a,this.formatData({},b,c,d,e))},update:function(a,b,c,d,e,f){return this.doGenericAction("update",a,this.formatData(b,c,d,e,f))},"delete":function(a,b,c,d,e){return this.doGenericAction("delete",a,this.formatData({},b,c,d,e))},link:function(a,b,c,d,e,f){return this.doGenericAction("link",a,this.formatData(b,c,d,e,f))},patch:function(a,b,c,d,e,f){return this.doGenericAction("patch",a,this.formatData(b,c,d,e,f))},formatData:function(a,b,c,d,e){return{data:a,criteria:b||{},orderBy:c||{},start:d||0,limit:e||null}},doGenericAction:function(a,c,d){var e,f=this.getDriversByTypeAndAction(c,a),g=b.Deferred(),h=function(a,b){g.resolve(a,b)},i=function(a){console.log(a),g.reject(a)};for(e in f)f.hasOwnProperty(e)&&this.drivers[f[e]].handle(a,c,d).done(h).fail(i);return g.promise()},getDriversByTypeAndAction:function(a,b){var c=null;return this.mappings.hasOwnProperty(a)&&this.mappings[a].hasOwnProperty(b)&&(c=this.mappings[a][b].drivers),null===c&&(c=[this.defaultDriverId]),c},reset:function(){this.drivers={},this.defaultDriverId=null,this.mappings={}}});return new JS.Singleton(c)}),define("Core/Exception",["Core/Api","jsclass"],function(){"use strict";var a=new JS.Class({Api:require("Core/Api"),initialize:function(a,b,c,d){this.name=a,this.message=b,this.code=c,this.params=d,this.stack=this.getStack()},getStack:function(){var a,b,c=new Error(this.name),d=[];if(c.stack){a=c.stack.split("\n"),d=a.slice(5);for(b in d)d.hasOwnProperty(b)&&(d[b]=this.parseStackLine(d[b]))}return d},pushError:function(a,b){void 0===b.get("errors")&&b.set("errors",[]),b.get("errors").push(a),b.set("lastError",a)},parseStackLine:function(a){var b=/^\s*at\s+([\w\W]+)\(([\w\W]+\.js)[\w\W]*:(\d+):(\d+)\)/i,c=b.exec(a),d=c&&c[1]?c[1]:a,e=c&&c[2]?c[2]:null,f=c&&c[3]?c[3]:null,g=c&&c[4]?c[4]:null;return{column:g,line:f,file:e,call:d}}}),b=function(b,c,d,e){b=b||"UnknowException",c=c||500,d=d||"No description found for this exception.",e=e||{};var f=new a(b,d,c,e);throw f.pushError(f,f.Api),"Error n "+c+" "+b+": "+d};b.silent=function(a,c,d,e){try{b(a,c,d,e)}catch(f){return f}},require("Core/Api").register("exception",b)}),define("Core/Mediator",["Core/Api"],function(a){"use strict";var b=function(a,b){this.callback=a,this.context=b},c=function(){this.topics={},this.publicated={},this.subscribe_once={}};b.prototype.execute=function(){void 0===this.context?this.callback.apply(void 0,arguments):this.callback.apply(this.context,arguments)},c.prototype.subscribe=function(a,c,d){var e=new b(c,d);this.topics.hasOwnProperty(a)||(this.topics[a]=[]),this.topics[a].push(e),this.publicated.hasOwnProperty(a)&&e.execute.apply(e,this.publicated[a].args)},c.prototype.subscribeOnce=function(a,b,c){this.subscribe_once.hasOwnProperty(a)||(this.subscribe_once[a]=[]),this.subscribe_once[a].push(b),this.subscribe(a,b,c)},c.prototype.unsubscribe=function(a,b){var c;if(this.topics.hasOwnProperty(a))for(c=0;c<this.topics[a].length;c+=1)this.topics[a][c].callback===b&&this.topics[a].splice(c,1)},c.prototype.publish=function(){var b,c,d=Array.prototype.slice.call(arguments),e=d.shift();if(this.topics.hasOwnProperty(e))for(b=0;b<this.topics[e].length;b+=1){c=this.topics[e][b].callback;try{this.topics[e][b].execute.apply(this.topics[e][b],d)}catch(f){a.exception.silent("MediatorException",12201,'Mediator caught an error when the topic : "'+e+'" was published.',{topic:e,context:this.topics[e][b].context,callback:this.topics[e][b].callback,args:d,error:f})}if(this.subscribe_once.hasOwnProperty(e))for(b=0;b<this.subscribe_once[e].length;b+=1)this.subscribe_once[e][b]===c&&this.unsubscribe(e,c)}},c.prototype.persistentPublish=function(){var a=Array.prototype.slice.call(arguments),b=a.shift();this.publish.apply(this,arguments),this.publicated[b]={args:a}},c.prototype.removePublish=function(a){this.publicated[a]=null,delete this.publicated[a]},a.register("Mediator",new c)}),define("Core/Renderer",["require","nunjucks","Core","jquery","Core/Utils","jsclass"],function(a,b,c){"use strict";var d,e=a("jquery"),f={},g=new JS.Class({initialize:function(){var a=f.error_tpl||"<p>Error while loading template</p>",c=f.placeholder||"<p>Loading...</p>";this.env=b.configure({watch:!1}),this.engine=b,this.render_action="html",this.error_msg=e(a).clone(),this.placeholder=e(c),this.functions={}},getEngine:function(){return this.engine},addFilter:function(a,b,c){this.env.addFilter(a,b,c)},addFunction:function(a,b){"function"==typeof b&&(this.functions[a]=b)},mergeParameters:function(a){var b;a||(a={});for(b in this.functions)this.functions.hasOwnProperty(b)&&(a[b]=this.functions[b]);return a},asyncRender:function(b,c,d){if(c=this.mergeParameters(c),d=d||{},d.placeholder=d.placeholder||this.placeholder,d.action=d.action||"html",!b||"string"!=typeof b)throw"Renderer:asyncRender [path] parameter should be a string";return a("Core/Utils").requireWithPromise(["text!"+b]).then(e.proxy(this.onTemplateReady,this,d,c),e.proxy(this.errorRenderer,this,d)),e(d.placeholder)},render:function(a,b){b=this.mergeParameters(b);try{return this.engine.renderString(a,b)}catch(d){c.exception("RenderException",500,d.message,{engineException:d,template:a,params:b})}},errorRenderer:function(a){e(a.placeholder)[a.action](this.error_msg)},onTemplateReady:function(a,b,c){e(a.placeholder)[a.action](this.engine.renderString(c,b))}}),h=function(){return void 0===d&&(d=new g),d},i=function(a){f=a},j=function(a){return function(b){return function(){var c=Array.prototype.slice.call(arguments);return b[a].apply(b,c)}}(h())},k={init:i,getEngine:j("getEngine"),render:j("render"),asyncRender:j("asyncRender"),addFilter:j("addFilter"),addFunction:j("addFunction")};return k}),define("Core/Request",["jsclass"],function(){"use strict";var a=new JS.Class({initialize:function(){this.url="",this.method="GET",this.data=null,this.headers={"Content-Type":"application/x-www-form-uriencoded"}},setUrl:function(a){return this.url=a,this},setMethod:function(a){return this.method=a.toUpperCase(),this},setData:function(a){return this.data=a,this},setHeaders:function(a){return this.headers=a,this},addHeader:function(a,b){return this.headers[a]=b,this},setContentType:function(a){return this.addHeader("Content-Type",a),this},getUrl:function(){return this.url},getContentType:function(){return this.headers["Content-Type"]},getMethod:function(){return this.method},getData:function(){return this.data},getHeader:function(a){return this.headers[a]||null},getHeaders:function(){return this.headers}});return a}),define("Core/RequestHandler",["Core/Api","jquery","underscore","BackBone","Core/Response","jsclass"],function(a,b,c,d,e){"use strict";var f=new JS.Class({initialize:function(){c.extend(this,d.Events)},send:function(c){var d=this,e=b.Deferred();return null!==c&&(a.Mediator.publish("request:send:before",c),b.ajax({url:c.getUrl(),type:c.getMethod(),data:c.getData(),headers:c.getHeaders()}).done(function(b,c,f){var g=d.buildResponse(f.getAllResponseHeaders(),b,f.responseText,f.status,c,"");a.Mediator.publish("request:send:done",g),e.resolve(g.getData(),g)}).fail(function(b,c,f){var g=d.buildResponse(b.getAllResponseHeaders(),"",b.responseText,b.status,c,f);a.Mediator.publish("request:send:fail",g),e.reject(g.getData(),g)})),e.promise()},buildResponse:function(a,b,c,d,f,g){var h=new e;return this.buildHeaders(h,a),h.setData(b),h.setRawData(c),h.setStatus(d),h.setStatusText(f),h.setErrorText(g),h},buildHeaders:function(a,b){var c,d,e,f,g,h;c=b.split("\r");for(g in c)c.hasOwnProperty(g)&&(d=c[g],h=d.indexOf(":"),-1!==h&&(e=d.substring(0,h).trim(),f=d.substring(h+1).trim(),a.addHeader(e,f)))}});return new JS.Singleton(f)}),define("Core/Response",["jsclass"],function(){"use strict";var a=new JS.Class({initialize:function(){this.headers={},this.data="",this.rawData="",this.status=200,this.statusText="",this.errorText=""},getHeaders:function(){return this.headers},getHeader:function(a){return this.headers[a]||null},getData:function(){return""===this.data?this.rawData:this.data},getRawData:function(){return this.rawData},getStatus:function(){return this.status},getStatusText:function(){return this.statusText},getErrorText:function(){return this.errorText},getUidFromLocation:function(){var a,b,c=this.getHeader("Location");return null===c?null:(b=new RegExp("[/]([a-f0-9]{32}$)"),a=b.exec(c),a[1])},getRangeFrom:function(){var a,b=this.getHeader("Content-Range");return null===b?null:(a=b.split("-"),void 0===a[0]?null:parseInt(a[0],10))},getRangeTo:function(){var a,b,c=this.getHeader("Content-Range");return null===c?null:(a=c.split("/"),void 0===a[0]?null:(b=a[0].split("-"),void 0===b[1]?null:parseInt(b[1],10)))},getRangeTotal:function(){var a,b=this.getHeader("Content-Range");return null===b?null:(a=b.split("/"),void 0===a[1]?null:parseInt(a[1],10))},setHeaders:function(a){return this.headers=a,this},addHeader:function(a,b){return this.headers[a]=b,this},setData:function(a){return this.data=a,this},setRawData:function(a){return this.rawData=a,this},setStatus:function(a){return this.status=a,this},setStatusText:function(a){return this.statusText=a,this},setErrorText:function(a){return this.errorText=a,this}});return a}),define("Core/RestDriver",["Core/Request","Core/RequestHandler","URIjs/URI","Core","jsclass"],function(a,b,c,d){"use strict";var e=new JS.Class({initialize:function(){this.baseUrl="",this.request=null},setBaseUrl:function(a){this.baseUrl=a},handle:function(e,f,g){var h,i=new c(this.baseUrl);return this.request=new a,this.request.headers={},this.request.setContentType("application/json"),this.request.addHeader("Accept","application/json"),i.segment(f),"read"===e?(this.request.setMethod("GET"),this.computeCriteria(i,g)):"update"===e||"patch"===e||"link"===e||"delete"===e?(this.request.setMethod("update"===e?"put":e),this.computeCriteria(i,g),g.hasOwnProperty("data")&&this.request.setData("patch"===e?this.computePatchOperations(g.data):g.data)):"create"===e&&(this.request.setMethod("POST"),this.computeCriteria(i,g),g.hasOwnProperty("data")&&this.request.setData(g.data)),g.hasOwnProperty("limit")&&null!==g.limit&&(h=(g.hasOwnProperty("start")?g.start:"0")+","+g.limit,this.request.addHeader("Range",h)),this.computeOrderBy(i,g),this.request.setUrl(i.normalize().toString()),null!==this.request.getData()&&this.request.setData(JSON.stringify(this.request.getData())),d.Mediator.publish("rest:send:before",this.request),b.send(this.request)},computeCriteria:function(a,b){var c,d=b.hasOwnProperty("criteria")?b.criteria:null;if(null===d)return this;for(c in d)d.hasOwnProperty(c)&&("uid"===c||"id"===c?a.segment(d[c].toString()):a.addSearch(c+("object"==typeof d[c]?"[]":""),d[c]));return this},computeOrderBy:function(a,b){var c;if(b.hasOwnProperty("orderBy")&&"object"==typeof b.orderBy)for(c in b.orderBy)b.orderBy.hasOwnProperty(c)&&a.addSearch("order_by["+c+"]",b.orderBy[c]);return this},computePatchOperations:function(a){var b,c=[];for(b in a)a.hasOwnProperty(b)&&c.push({op:"replace",path:"/"+b,value:a[b]});return c}}),f=new e;return{handle:function(a,b,c){return f.handle(a,b,c)},setBaseUrl:function(a){return f.setBaseUrl(a),this}}}),define("Core/RouteManager",["jquery","Core/Api","BackBone","Core/ApplicationManager","jsclass"],function(a,b,c){"use strict";var d=require("Core/ApplicationManager"),e={},f=new JS.Class({initialize:function(){var a=c.Router.extend({execute:function(a,b){"function"==typeof a&&a.apply(this,b)}});this.routes={},this.mainRouter=new a({}),this.handleApplicationLinks()},handleApplicationLinks:function(){var b,c,d=this;a("body").delegate("a","click",function(f){var g=a(this).data("action");if("string"==typeof g){if(f.preventDefault(),c=e[g],!a.isPlainObject(c))throw"RouteManager:handleApplicationLinks route "+g+" can't be found";b=d.buildLink(g),d.navigate(b)}})},buildLink:function(b,c){var d,f;if(!1===e.hasOwnProperty(b))throw"RouteManager:buildLink routeInfos can't be found";return d=e[b],c=c||d.defaults,f=d.url,d.hasOwnProperty("defaults")&&a.each(d.defaults,function(a,b){f=f.replace(a,b)}),f},navigate:function(a,b,c){var d={trigger:b||!0,replace:c||!0};this.mainRouter.navigate(a,d)},genericRouteHandler:function(b){var c=a.merge([],arguments);c.pop(),d.invoke(b,c)},registerRoute:function(b){var c=b.completeName.split(":");c=c[0],this.mainRouter.route(b.url,b.completeName,a.proxy(this.genericRouteHandler,this,c+":"+b.action))}}),g=new f,h={initRouter:function(a){return a=a||{},c.history.start(a),this},registerRoute:function(b,c){var d=c.routes,f="",h="";if(!c.hasOwnProperty("routes"))throw"A routes key must be provided";if(!a.isPlainObject(c.routes))throw"Routes must be an object";"string"==typeof c.prefix&&(f=c.prefix),a.each(d,function(c,d){if(!a.isPlainObject(d))throw c+" route infos must be an object";if(!d.hasOwnProperty("url"))throw c+" route infos must have `url` property";if(!d.hasOwnProperty("action"))throw c+" route infos must have `action` property";0!==f.length&&(h=0===d.url.indexOf("/")?d.url.substring(1):d.url,d.url=f+"/"+h),d.completeName=b+":"+c,e[d.completeName]=d,g.registerRoute(d)})},navigate:function(a,b,c){this.navigateByPath(a,b,c)},navigateByPath:function(a,b,c){g.navigate(a,b,c)},navigateByName:function(a,b,c){this.navigateByPath(g.buildLink(a),b,c)}};return b.register("RouteManager",h),h}),define("Core/Scope",["Core/Api","underscore"],function(a,b){"use strict";var c=function(){this.scopes=[],a.Mediator.subscribeOnce("on:application:ready",function(){a.Mediator.persistentPublish("scope:global:opening")})},d=function(b,c){var d;for(d=0;d<b.length;d+=1)a.Mediator.publish(c===!0?"scope:"+b[d].toLowerCase()+":opening":"scope:"+b[d].toLowerCase()+":closing")},e=function(b){var c;for(c=0;c<b.length;c+=1)"string"!=typeof b[c]&&a.exception("ScopeException",12101,"All scope have to be a string.")};c.prototype.register=function(){var a=b.difference(arguments,this.scopes),c=b.difference(this.scopes,arguments);e(arguments),d(c,!1),d(a,!0),this.scopes=b.difference(this.scopes,c),this.scopes=b.union(this.scopes,a)},c.prototype.open=function(a){var c=b.indexOf(this.scopes,a);e([a]),-1===c&&(d([a],!0),this.scopes.push(a))},c.prototype.close=function(a){var c=b.indexOf(this.scopes,a);e([a]),-1!==c&&(d([a],!1),this.scopes=b.without(this.scopes,a))},c.prototype.subscribe=function(c,d,e){var f=b.indexOf(this.scopes,c.toLowerCase());if(("string"!=typeof c||"function"!=typeof d||"function"!=typeof e)&&a.exception("ScopeException",12102,"Scope subscription was incorrect."),-1!==f)try{d.apply(void 0)}catch(g){a.exception.silent("ScopeException",12103,'Error while running Opening callback in scope "'+c+'"" with message: '+g)}a.Mediator.subscribe("scope:"+c.toLowerCase()+":opening",d),a.Mediator.subscribe("scope:"+c.toLowerCase()+":closing",e)},a.register("Scope",new c)}),define("Core/Utils",["jquery","Core/Api"],function(a,b){"use strict";var c=function f(b){return this.dataContainer={},this.itemCount=0,this.idKey=null,this.maxEntry=null,this.onChange=function(){},this.onDestroy=function(){},this.onInit=function(){},this.onAdd=function(){},this.onReplace=function(){},this.onDelete=function(){},"function"!=typeof this.init&&(this.init=function(a){if(a&&!a.hasOwnProperty("idKey"))throw"SmartList:init if a config param is provided a config.idKey is expected";a=a||{},this.name=a.name||"list_"+(new Date).getTime();var b=a.data||{};this.onChange="function"==typeof a.onChange?a.onChange:this.onChange,this.onDestroy="function"==typeof a.onDestroy?a.onDestroy:this.onDestroy,a.idKey&&(this.idKey=a.idKey),this.onInit="function"==typeof a.onInit?a.onInit:this.onInit,this.onAdd="function"==typeof a.onAdd?a.onAdd:this.onAdd,this.onReplace="function"==typeof a.onReplace?a.onReplace:this.onReplace,this.onDelete="function"==typeof a.onDelete?a.onDelete:this.onDelete,a.maxEntry&&(this.maxEntry=parseInt(a.maxEntry,10)),this.setData(b),this.itemCount=this.getSize()}),f.prototype.setMaxEntry=function(a){this.maxEntry=a||null},f.prototype.set=function(b,c){if(this.idKey&&!a.isPlainObject(b))throw"SmartList:set item should be an object when and idKey is set";if(this.idKey&&a.isPlainObject(b)){if(!b.hasOwnProperty(this.idKey))throw"SmartList:set should have a key "+this.idKey;c=b,b=b[this.idKey]}if(!this.dataContainer.hasOwnProperty(b)){var d=this.itemCount+1;if(this.maxEntry&&d>this.maxEntry)return;this.itemCount=d}this.dataContainer[b]=c,this.onChange(this.dataContainer,this.name,c)},f.prototype.get=function(a){return this.dataContainer[a]||!1},f.prototype.destroy=function(){var a=this;this.dataContainer={},this.itemCount=0,this.onDestroy(a)},f.prototype.reset=function(){this.destroy()},f.prototype.getData=function(){return this.dataContainer},f.prototype.toArray=function(b){var c=this,d=[];return b?a.each(this.dataContainer,function(a){d.push(c.dataContainer[a])}):d=a.makeArray(this.dataContainer),d},f.prototype.replaceItem=function(a){if(!arguments.length)throw"SmartList:replaceItem expects one parameter";if(!a.hasOwnProperty(this.idKey))throw"SmartList:deleteItem [item] should have a ["+this.idKey+"] key";this.dataContainer[a[this.idKey]]=a,this.onReplace(this.dataContainer,this.name,a)},f.prototype.deleteItem=function(b){if(!arguments.length)throw"SmartList:replaceItem expects one parameter";if(!a.isPlainObject(b))throw"SmartList:deleteItem [item] should be a object";if(!b.hasOwnProperty(this.idKey))throw"SmartList:deleteItem [item] should have a ["+this.idKey+"] key";delete this.dataContainer[b[this.idKey]],this.itemCount=this.itemCount-1,this.onDelete(this.dataContainer,this.name,b)},f.prototype.deleteItemById=function(a){return this.dataContainer.hasOwnProperty(a)?(delete this.dataContainer[a],this.itemCount=this.itemCount-1,void this.onDelete(this.dataContainer,this.name,a)):!1},f.prototype.setData=function(b){var c,d=this;if(!b)throw"SmartList:setData data must be provided";if(a.isArray(b)){if(!this.idKey)throw"SmartList:setData idKey must be provided";a.each(b,function(a){c=b[a],c.hasOwnProperty(d.idKey)&&d.set(c)})}else this.dataContainer=b;this.onInit(this.dataContainer)},f.prototype.addData=function(b){var c,d=this,e=[];if(a.isArray(b)){if(!this.idKey)throw"SmartList:addData idKey must be provided";a.each(b,function(a){c=b[a],c.hasOwnProperty(d.idKey)&&(d.set(c),e.push(c))})}else this.dataContainer=a.extend(!0,this.dataContainer,b);this.onAdd(e)},f.prototype.getSize=function(){var a=this.toArray(!0);return a.length},this.init(b)},d=function(b,c){var d=new a.Deferred;return c?(b.splice(0,0,"require"),require(b,function(a){d.resolve.call(this,a)},function(a){d.reject(a)})):require(b,function(){d.resolve.apply(this,arguments)},function(a){d.reject(a)}),d.promise()},e=function(a){return a instanceof Object&&!(a instanceof Array)&&(a=Object.keys(a).map(function(b){return a[b]})),a};return b.register("SmartList",c),{SmartList:c,requireWithPromise:d,castAsArray:e}});